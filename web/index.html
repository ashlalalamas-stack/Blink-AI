<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BLINK</title>
<style>
:root {
  --bg: #0d0d0d;
  --panel: #1a1a1a;
  --accent: #4caf50;
  --text: #f5f5f5;
  --user-msg: #2d2d2d;
  --assistant-msg: #1e4620;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  margin: 0;
}

header {
  background: var(--panel);
  padding: 0.75rem 1rem;
  text-align: center;
  font-weight: 600;
  border-bottom: 1px solid #333;
}

#chat {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.msg {
  max-width: 75%;
  padding: 0.5rem 0.75rem;
  border-radius: 8px;
}

.msg.user {
  align-self: flex-end;
  background: var(--user-msg);
}

.msg.assistant {
  align-self: flex-start;
  background: var(--assistant-msg);
}

#input {
  display: flex;
  gap: 0.5rem;
  padding: 0.75rem;
  background: var(--panel);
  border-top: 1px solid #333;
}

textarea {
  flex: 1;
  background: var(--bg);
  color: var(--text);
  border: 1px solid #333;
  border-radius: 4px;
  padding: 0.5rem;
  resize: none;
}

button {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 0 1rem;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

label {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.9rem;
}
</style>
</head>
<body>
<header>BLINK Chat</header>
<div id="chat"></div>
<div id="input">
  <label><input type="checkbox" id="privacy"/> Privacy</label>
  <textarea id="text" rows="2" placeholder="Type a message..."></textarea>
  <button id="send">Send</button>
  <button id="runpy">Run Py</button>
</div>
<script>
const chat = document.getElementById('chat');
const text = document.getElementById('text');
const send = document.getElementById('send');
const runpy = document.getElementById('runpy');
const privacy = document.getElementById('privacy');
let messages = [];

function append(role, content, local) {
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  const icon = local === undefined ? '' : (local ? '🛡️ ' : '🌐 ');
  div.textContent = icon + content;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

send.onclick = async () => {
  const content = text.value.trim();
  if (!content) return;
  append('user', content);
  messages.push({ role: 'user', content });
  text.value = '';
  const res = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages, privacyMode: privacy.checked })
  });
  const data = await res.json();
  messages.push({ role: 'assistant', content: data.reply });
  append('assistant', data.reply, data.local);
};

text.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    send.click();
  }
});

runpy.onclick = async () => {
  const code = text.value.trim();
  if (!code) return;
  append('user', code);
  text.value = '';
  const res = await fetch('/api/python', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ code })
  });
  const data = await res.json();
  const out = (data.stdout || '') + (data.stderr || '');
  append('assistant', out, true);
};
</script>
</body>
</html>
